{% load static %}
{% load bootstrap4 %}

<!DOCTYPE html>
<html>
<head>
    {% include 'default_head.html' %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{% static 'videos.css' %}">

    <script>
        // Function to toggle hide hidden videos
        // video_id: The ID of the era where to toggle hide the hidden videos
        function toggleHide(video_id) {
            // Get all contents with the ID of the current row
            var video_row = Array.from(document.querySelectorAll('[id='+"video-hide-"+video_id+']'));
            // Iterate through every row with the returned ID
            for (var i = 0; i < video_row.length; i++) {
                // Toggle the class 'video-hide'
                video_row[i].classList.toggle("video-hide");
            }
        }

        function changeIcon(video_id){
            var button = document.getElementById("color-btn-video-" + video_id);

            if (button.innerHTML === '∨') {
                button.innerHTML = '∧';
            }
            else {
                button.innerHTML = '∨';
            }

        }

        function stopPopupVideo(section, id) {
            var video = document.getElementById("popup-video-" + section + "-" + id);
            var popup = "popup-" + section + "-" + id;
            $('#' + popup).on('hidden.bs.modal', function () {
                video.pause();
            });
        }
    </script>
</head>

<body>

    {% include './header.html' %}

    <div class="container container-page">
        <!-- Iterate through all eras -->
        {% for era,videos in Era.items %}
            <div class="row video-section">
                <div class="video-section-title">
                    <!-- Cycle through all eras as title -->
                    <h1 style="border-bottom-style: solid; border-bottom-color: #{{ era.color_code }}">{{ era.name }}</h1>
                </div>
                    <!-- Iterate through all videos of every era -->
                    {% for video in videos %}
                        <!-- Add a new video row every four videos -->
                        {% if forloop.counter0|divisibleby:4 or forloop.first %}
                            {% if forloop.counter <= 4 %}
                                <!-- The first row of videos -->
                                <div class="row row-video row-no-margin">
                            {% else %}
                                <!-- Every other row of videos which is hidden until clicked on the button -->
                                <div id="video-hide-{{ forloop.parentloop.counter }}" class="row row-video row-no-margin video-hide">
                            {% endif %}
                        {% endif %}
                            <!-- Distinguish between first, middle and last video of the current row -->
                            <div class="video-box">
                                <!-- Add video Thumbnail -->
                                <img class="video" src="/media/{{ video.thumbnail }}" data-toggle="modal" data-target="#popup-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" style="width: 100%">

                                <div class="video-title break-words">
                                    {{ video.title }}
                                </div>

                                <div class="modal" id="popup-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" data-keyboard="false" onclick="stopPopupVideo({{ forloop.parentloop.counter }}, {{ forloop.counter }})">
                                    <div class="modal-dialog modal-xl modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" style="overflow: hidden;">{{ video.title }}</h4>
                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            </div>
                                            <div class="modal-body">
                                                <video preload="none" poster="/media/{{ video.thumbnail }}" id="popup-video-{{ forloop.parentloop.counter }}-{{ forloop.counter }}" width="100%" controls oncontextmenu="return false;" controlsList="nodownload">
                                                    <source src="{{ video.video.url }}" type="video/mp4">
                                                    {{ video.title }}
                                                </video>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% if forloop.counter|divisibleby:4 or forloop.last %}
                            </div>
                        {% endif %}
                    {% endfor %}
                <!-- Add button to toggle hide the hidden videos -->
                {% if videos|length > 4 %}
                    <div style="width: 100%">
                        <button class="button more-videos-button" id="color-btn-video-{{ forloop.counter }}" onclick="toggleHide({{ forloop.counter }}),changeIcon({{ forloop.counter }})">∨</button>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <div>
        {% for foo, foo1 in Test.items %}
            {{ foo }}<br>
            {% for fooNew in foo1 %}
                {{ fooNew }}
            {% endfor %}<br>

        {% endfor %}

    </div>
</body>
</html>